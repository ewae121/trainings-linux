<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/black.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
    <style type="text/css">
      p { text-align: left; }
      .folders {
        border: 1px solid white;
      }
    </style>
	</head>
	<body>
<div class="reveal">
<div class="slides">

<!--Introduction-->
<section>
	<section>
   	    <h1>Bash training</h1>
	</section>
	<section>
   	    <h2>Why this presentation?</h2>
        <ul>
            <li>After the Linux FHS presentation people wanted to learn concrete things.</li>
            <li>This will help people to write scripts.</li>
            <li>This presentation is for beginners and intermediate people who have some skills.</li>
        </ul>
    </section>
	<section>
        <h2>Main References:</h2>
        <ul>
            <li><a href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)" target="_blank">Wikipedia bash</a></li>
            <li><a href="https://www.gnu.org/software/bash/" target="_blank">Bash Official page</a></li>
            <li><a href="https://tiswww.case.edu/php/chet/bash/bashref.html" target="_blank">Bash Official documentation</a></li>
            <li><a href="https://github.com/ewae121/wiki.bash-hackers.org" target="_blank">Dokuwiki bash Hackers(doesn't exist anymore)</a></li>
        </ul>
    </section>
</section>

<!--What is bash-->
<section>
	<section>
        <h2><a href="https://www.gnu.org/software/bash/" target="_blank">What is Bash?</a></h2>
    </section>
	<section>
    	<h2>Question:</h2>
        <div class="fragment fade-in">
        	<p>What is bash?</p>
            <ul style="width:100%;text-align:left">
                <li>A terminal to type commands</li>
                <li>A command language interpreter</li>
                <li>A shell</li>
                <li>An interpreted language</li>
            </ul>
        </div>
    </section>
	<section>
        <h2><a href="https://www.gnu.org/software/bash/manual/html_node/What-is-Bash_003f.html" target="_blank">What is Bash - Official documentation 1/2</a></h2>

        <p>Bash is the shell, or command language interpreter, for the GNU operating system. The name is an acronym for the ‘Bourne-Again SHell’, a pun on Stephen Bourne, the author of the direct ancestor of the current Unix shell sh, which appeared in the Seventh Edition Bell Labs Research version of Unix.</p>
    </section>
	<section>
        <h2><a href="https://www.gnu.org/software/bash/manual/html_node/What-is-Bash_003f.html" target="_blank">What is Bash - Official documentation 2/2</a></h2>

        <p><ul>
            <li class="fragment fade-in">Bash is largely compatible with sh and incorporates useful features from ksh and csh.</li>
            <li class="fragment fade-in">Bash is intended to be a conformant implementation of the IEEE POSIX Shell.</li>
            <li class="fragment fade-in">Bash offers functional improvements over sh for both interactive and programming use.</li>
            <li class="fragment fade-in">Bash is often the default shell for GNU Operating System.</li>
        </ul></p>
    </section>
</section>

<!--What is a shell-->
<section>
	<section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#What-is-a-shell_003f" target="_blank">What is a Shell?</a></h2>
    </section>
	<section>
    	<h2>Question:</h2>
        <div class="fragment fade-in">
        	<p>What is Unix shell?</p>
            <ul style="width:100%;text-align:left">
                <li>A command interpreter</li>
                <li>A programming language</li>
                <li>A macro processor</li>
            </ul>
        </div>
    </section>
	<section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#What-is-a-shell_003f" target="_blank">What is a Shell? Historic</a></h2>

        <p>At its base, a shell is simply a macro processor that executes commands. The term macro processor means functionality where text and symbols are expanded to create larger expressions.</p>
    </section>
	<section>
        <h2><a href="https://www.gnu.org/software/bash/manual/html_node/What-is-Bash_003f.html" target="_blank">What is a Shell - Features</a></h2>

        <p>A Unix shell is both a command interpreter and a programming language.</p>    
        <ul>
            <li class="fragment fade-in">As a command interpreter, the shell provides the user interface to the rich set of GNU utilities.</li>
            <li class="fragment fade-in">The programming language features allow these utilities to be combined.</li>
        </ul>
    </section>
	<section>
        <h2><a href="https://www.gnu.org/software/bash/manual/html_node/What-is-Bash_003f.html" target="_blank">What is a Shell - Scripting</a></h2>

        <p>Files containing commands can be created, and become commands themselves. These new commands have the
        same status as system commands in directories such as /bin, allowing users or groups to establish custom
        environments to automate their common tasks.</p>    
    </section>
	<section>
        <h2><a href="https://www.gnu.org/software/bash/manual/html_node/What-is-Bash_003f.html" target="_blank">What is a Shell - Interactivity</a></h2>

        <p>Shells may be used interactively or non-interactively. In interactive mode, they accept input typed from the keyboard. When executing
        non-interactively, shells execute commands read from a file.</p>
    </section>
	<section>
        <h2><a href="https://www.gnu.org/software/bash/manual/html_node/What-is-Bash_003f.html" target="_blank">What is a Shell - Execution types</a></h2>

        <p>A shell allows execution of GNU commands, both synchronously and asynchronously. The shell waits for synchronous commands
        to complete before accepting more input; asynchronous commands continue to execute in parallel with the shell while it reads
        and executes additional commands. The redirection constructs permit fine-grained control of the input and output of those commands.
        Moreover, the shell allows control over the contents of commands’ environments.</p>
    </section>
	<section>
        <h2><a href="https://www.gnu.org/software/bash/manual/html_node/What-is-Bash_003f.html" target="_blank">What is a Shell - Builtins</a></h2>

        <p>Shells also provide a small set of built-in commands (builtins) implementing functionality impossible or inconvenient to obtain
        via separate utilities.For example, cd, break, continue, and exec cannot be implemented outside of the shell because they directly
        manipulate the shell itself. The history, getopts, kill, or pwd builtins, among others, could be implemented in separate utilities,
        but they are more convenient to use as builtin commands.</p>
    </section>
	<section>
        <h2><a href="https://www.gnu.org/software/bash/manual/html_node/What-is-Bash_003f.html" target="_blank">What is a Shell - Programming Language</a></h2>

        <p>While executing commands is essential, most of the power (and complexity) of shells is due to their embedded programming languages. Like any high-level language, the shell provides variables,
        flow control constructs, quoting, and functions.</p>
    </section>
</section>

<!--Shell operation-->
<section>
	<section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">How work a Shell?</a></h2>
    </section>
	<section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Read input</a></h2>

        <p>Reads its input:</p>
        <ul>
            <li class="fragment fade-in">from the user’s terminal.<pre>echo toto</pre></li>
            <li class="fragment fade-in">from a string supplied as an argument to the -c invocation option (see Invoking Bash)<pre>bash -c "echo toto"</pre></li>
            <li class="fragment fade-in">from a file (see Shell Scripts)<pre>echo "echo toto" > script && bash script</pre></li>
        </ul>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Parse tokens</a></h2>

        <p>Breaks the input into words and operators, obeying the quoting rules described in Quoting. These tokens are separated by metacharacters. Alias expansion is performed by this step</p>
        <ul>
            <li class="fragment fade-in">metacharacters list is: <pre>space, tab, newline, ‘|’, ‘&’, ‘;’, ‘(’, ‘)’, ‘<’, ‘>’</pre></li>
            <li class="fragment fade-in">defined alias list can be displayed using: <pre>alias -p</pre></li>
        </ul>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Make command(s)</a></h2>

        <p>Parses the tokens into simple and compound commands</p>
        <ul class="r-fit-text">
            <li class="fragment fade-in">A simple command is the kind of command encountered most often. It’s just a sequence of words separated by blanks, terminated by one of the shell’s control operators. The first word generally specifies a command to be executed, with the rest of the words being that command’s arguments. Control operators: <pre>newline, ‘||’, ‘&&’, ‘&’, ‘;’, ‘;;’, ‘;&’, ‘;;&’, ‘|’, ‘|&’, ‘(’, or ‘)’</pre></li>
            <li class="fragment fade-in">Compound commands are the shell programming language constructs.<pre>until test-commands; do consequent-commands; done</pre></li>
        </ul>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Compound commands quizz</a></h2>
        <pre>
            until [ -f toto ]; do echo 2; sleep 2; done &
        </pre>
        <ul>
            <li class="fragment fade-in">What the command will do?</li>
            <li class="fragment fade-in">How can I stop it?</li>
        </ul>
        <pre class="fragment fade-in">
            until false; do echo 2 sleep 2; done
        </pre>
        <ul>
            <li class="fragment fade-in">What the command will do?</li>
            <li class="fragment fade-in">How to add the delay?</li>
        </ul>
        <pre class="fragment fade-in">
            until false; do echo 2; sleep 2; done &
        </pre>
        <ul>
            <li class="fragment fade-in">How to stop it?</li>
        </ul>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Perform expansion</a></h2>

        <p>Performs the various shell expansions, breaking the expanded tokens into lists of filenames and commands and arguments.</p>
        <ul>
            <li class="fragment fade-in">shell expansions</li>
            <li class="fragment fade-in">filename expansions</li>
        </ul>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Shell expansion</a></h2>
        <ul class="r-fit-text">
            <li class="fragment fade-in">Brace expansion is a mechanism by which arbitrary strings may be generated.<pre>echo a{a,b,c}e</pre></li>
            <li class="fragment fade-in">Tilde expansion if a word begins with an unquoted tilde character<pre>echo ~ ~id</pre></li>
            <li class="fragment fade-in">The ‘$’ character introduces:</li>
        </ul>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Parameter expansion</a></h2>
            <div style="width:100%; font-size:x-large">
            <p>A parameter expansion $var or ${var}</p>
                <ul style="width:100%">
                    <li class="fragment fade-in">you can display a value: <pre>unset val; val="toto"; echo $val</pre></li>
                    <li class="fragment fade-in">you can return a default value: <pre>unset val; echo ${val:-"default"}; echo $val</pre></li>
                    <li class="fragment fade-in">you can return a default value: <pre>unset val; echo ${val:="default"}; echo $val</pre></li>
                    <li class="fragment fade-in">you can select a substring: <pre>unset val; val="toto"; echo ${val:1:-1}</pre></li>
                    <li class="fragment fade-in">you can remove a substring at the beginning: <pre>unset val; val="toto"; echo ${val#?}</pre></li>
                    <li class="fragment fade-in">you can remove a substring at the end: <pre>unset val; val="toto 20M"; echo "${val%20M}"</pre></li>
                </ul>
            </div>
        <pre>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Command expansion</a></h2>
            <p>A command expansion:</p>
            <ul>
                <li class="fragment fade-in">you can affect a command result value: <pre>unset val; val="$(date +"%M%H%S")"; echo $val</pre></li>
                <li class="fragment fade-in">you can affect a command result value: <pre>unset val; val=`date +"%M%H%S"`; echo $val</pre></li>
                <li class="fragment fade-in">you execute a string as: <pre>
echo "ls -l" > toto
$(cat toto)</pre></li>
            </ul>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Arithmetic expansion</a></h2>
            <p>A arithmetic expansion $(( )):</p>
            <pre>
                uidn4221@io:~/dev/trainings-linux$ echo "13 / 4 = $(( 13 /4 )) reste $(( 13 % 4 ))"
                13 / 4 = 3 reste 1
            </pre>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Filename expansion</a></h2>
            <p>After word splitting, unless the -f option has been set (see The Set Builtin), Bash scans each word for the characters ‘*’, ‘?’, and ‘[’. If one of these characters appears, and is not quoted,
            then the word is regarded as a pattern, and replaced with an alphabetically sorted list of filenames matching the pattern</p>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Filename expansion - Quizz</a></h2>
            <pre>
uidn4221@io:~/dev/trainings-linux$ touch tot{e,i,o touch tot{o,e,i}{a,e,i,o,u,y}
uidn4221@io:~/dev/trainings-linux$ ls tot*
tote  totea  totee  totei  toteo  toteu  totey  toti  totia  totie  totii  totio  totiu  totiy  toto  totoa  totoe  totoi  totoo  totou  totoy  totu
            </pre>
            <ul  class="r-fit-text" style="width:100%">
                <li class="fragment fade-in">how to get all toti files
                <ul>
                    <li class="fragment fade-in"><pre>ls toti*</pre></li>
                </ul></li>
                <li class="fragment fade-in">how to get all files containing toti and tote
                <ul>
                    <li class="fragment fade-in"><pre>ls tot[i,e]*</pre></li>
                </ul></li>
                <li class="fragment fade-in">how to get all files finishing by "e" vowel with 5 letters
                <ul>
                    <li class="fragment fade-in"><pre>ls tot?e</pre></li>
                </ul></li>
            </ul>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Redirection</a></h2>
            <p>Before  a command is executed, its input and output may be redirected using a special notation interpreted by the shell.  Redirection allows com‐
                mands' file handles to be duplicated, opened, closed, made to refer to different files, and can change the files the command  reads from and
                writes  to.  Redirection may also be used to modify file handles in the current shell execution environment. The following redirection operators
                may precede or appear anywhere within a simple command or may follow a command.  Redirections are processed in the order they appear,  from  left
                to right.</p>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Redirection - default behavior</a></h2>
            By default a command:
            <ul  class="r-fit-text" style="width:100%">
                <li class="fragment fade-in">Get its input from /dev/stdin (0)</li>
                <li class="fragment fade-in">Writes its output to /dev/stdout (1)</li>
                <li class="fragment fade-in">Writes its error to /dev/stderr (2)</li>
            </ul>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Redirection - Good to know</a></h2>
            <ul  class="r-fit-text" style="width:100%">
                <li class="fragment fade-in">When you write a program you must only write to stdout the command result
                    and log to /dev/stderr. That allow you to use the program in other scripts. (ex: uname)</li>
                <li class="fragment fade-in">Most of terminal display both stdout and stderr.</li>
                <li class="fragment fade-in">If the redirector start by '>' this refer to the standard output.</li>
            </ul>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Redirection - </a></h2>
        <div class="r-fit-text" style="width: 100%;">
            <p>Redirections are processed in the order they appear, from  left to right.</p>

            <ul  class="r-fit-text" style="width:100%">
                <li class="fragment fade-in">the command<pre>ls > dirlist 2>&1</pre>directs both standard output and standard error to the file dirlist, while the command</li>
                <li class="fragment fade-in">the command<pre>ls 2>&1 > dirlist</pre>directs only the standard output to file dirlist, because the standard error was duplicated from the standard output before the  standard  output 
                    was redirected to dirlist.</li>
                <li class="fragment fade-in">the command<pre>&>word</pre> and <pre>>&word</pre> Of the two forms, the first is preferred.  This is semantically equivalent to <pre> >word 2>&1</pre></li>
                <li class="fragment fade-in">The format for appending standard output and standard error is: <pre>&>>word</pre> This is semantically equivalent to <pre>>>word 2>&1</pre></li>
            </ul>
        </div>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Redirection - Will it be sent? :)</a></h2>
        <div class="r-fit-text" style="width: 100%;">
            <ul  class="r-fit-text" style="width:100%">
                <li class="fragment fade-in">We open a udp port<pre>nc -klu localhost 9000</pre></li>
                <li class="fragment fade-in"><pre>echo toto >/dev/udp/localhost/9000</pre></li>
                <li class="fragment fade-in"><pre>echo toto2 1>/dev/udp/localhost/9000</pre></li>
                <li class="fragment fade-in"><pre>echo toto3 2>/dev/udp/localhost/9000</pre></li>
                <li class="fragment fade-in"><pre>echo toto4 >&2 2>/dev/udp/localhost/9000</pre></li>
                <li class="fragment fade-in"><pre>echo toto5 1>&2 2>/dev/udp/localhost/9000</pre></li>
                <li class="fragment fade-in"><pre>echo toto6 2>/dev/udp/localhost/9000 1>&2</pre></li>
                <li class="fragment fade-in"><pre>echo toto7 2>/dev/udp/localhost/9000 >&2</pre></li>
            </ul>
        </div>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Execute command</a></h2>
        <div class="r-fit-text" style="width: 100%;">
            <ul  class="r-fit-text" style="width:100%">
                <li class="fragment fade-in">It locate the command to execute and start it. The command is placed as argument as $0.</li>
                <li class="fragment fade-in">It set the local environment, traps, umask creation...</li>
                <li class="fragment fade-in">After running it returns an exit status.</li>
            </ul>

            <p class="fragment fade-in">To check a program exit status. You can check the value of $? parameter. 127 means not found, 126 means found but not executable.
            0 means success and other values are errors.</p>
            <pre class="fragment fade-in">
uidn4221@io:~/dev/trainings-linux$ ls toto*
toto  totoa  totoe  totoi  totoo  totou  totoy
uidn4221@io:~/dev/trainings-linux$ echo $?
0
            </pre>

        </div>
    </section>
</section>

<!--Best Practices-->
<section>
	<section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html" target="_blank">Best Practices</a></h2>
    </section>
	<section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Shell-Operation" target="_blank">Start with an explicit Shebang</a></h2>

        <p>The shebang specify the interpreter you want to use to interprete lines.</p>
        <pre>
            #!/bin/bash
        </pre>
        <p>Note it exists a lot of interpreters. It could be anything that is able to interprete the lines in the file.</p>
    </section>

    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html" target="_blank">Use set -euo pipefail</a></h2>

        <div class="r-fit-text" style="width: 100%;">
            <ul class="r-fit-text">
                <li class="fragment fade-in">-e: when this option is on, if a simple command fails for any reason, the shell shall immediately exit, unless the simple command is followed by an && or ||, or is the command immediately following an if or while command, or the command immediately following a pipeline, a list, or a compound command.</li>
                <li class="fragment fade-in">-u: this will cause the program to automatically exit when an undefined variable is referenced.</li>
                <li class="fragment fade-in">-o pipefail: the return value of a pipeline is the status of the last command to exit with a non-zero status, or zero if no command exited with a non-zero status</li>
            </ul>
            <div class="fragment fade-in" style="width:100%">
                <pre>
#!/bin/bash
set -euo pipefail

echo toto
false
echo toto2
                </pre>
            </div>
            <div class="fragment fade-in" style="width:100%">
                <span style="text-align:left">will produce:</span>
            </div>
            <div class="fragment fade-in" style="width:100%">
                <pre>
uidn4221@io:~/dev/trainings-linux$ ./bash/false.sh || echo $?
toto
1
              </pre>
           </div>
        </div>
    </section>
    <section>
        <h2><a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html" target="_blank">Use set -euo pipefail</a></h2>

        <div class="r-fit-text" style="width: 100%;">
            <ul class="r-fit-text">
                <li class="fragment fade-in">Describe each command in a dedicated method</li>
                <li class="fragment fade-in">You can use shellcheck <pre>sudo apt install shellcheck</pre></li>
                <li class="fragment fade-in">Initiate current working directory to workno matter you launch the script</li>
            </ul>
            <div class="fragment fade-in" style="width:100%">
                <pre>
#!/bin/bash
set -euo pipefail

ls ./false_no_fail.sh
echo $?
                </pre>
            </div>
        </div>
    </section>
</section>
</div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script src="plugin/zoom/zoom.js"></script>
<script>
	// More info about initialization & config:
	// - https://revealjs.com/initialization/
	// - https://revealjs.com/config/
	Reveal.initialize({
		hash: true,

		// Learn about plugins: https://revealjs.com/plugins/
		plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom ]
	});
</script>
</body>

</html>
